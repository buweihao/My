<UserControl x:Class="MyConfig.Controls.TextDialog"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:hc="https://handyorg.github.io/handycontrol">
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <!-- 建议先引 Theme 再引 Skin -->
                <ResourceDictionary Source="pack://application:,,,/HandyControl;component/Themes/Theme.xaml" />
                <ResourceDictionary Source="pack://application:,,,/HandyControl;component/Themes/SkinDefault.xaml" />
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </UserControl.Resources>
    <!-- 背景蒙层（可选） -->
    <Grid Background="#66000000">
        <!-- 中心卡片 -->
        <Border Width="420"
                Height="460"
                CornerRadius="16"
                Background="{DynamicResource RegionBrush}"
                Padding="0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <!-- 头部 -->
                    <RowDefinition />
                    <!-- 列表 -->
                    <RowDefinition Height="Auto" />
                    <!-- 底部 -->
                </Grid.RowDefinitions>

                <!-- 顶部标题栏 -->
                <Border Grid.Row="0"
                        CornerRadius="16,16,0,0"
                        Background="{DynamicResource PrimaryBrush}"
                        Padding="16">
                    <DockPanel LastChildFill="False">
                        <TextBlock Text="修改配置"
                                   FontSize="18"
                                   FontWeight="SemiBold"
                                   Foreground="White"
                                   DockPanel.Dock="Left" />
                        <TextBlock Text="请仔细核对"
                                   Margin="12,0,0,0"
                                   Foreground="#CCFFFFFF"
                                   VerticalAlignment="Center"
                                   DockPanel.Dock="Left" />
                        <Button Width="28"
                                Height="28"
                                Margin="210,0,0,0"
                                Padding="0"
                                Background="#1FFFFFFF"
                                Foreground="White"
                                BorderBrush="{x:Null}"
                                HorizontalAlignment="Right"
                                Command="hc:ControlCommands.Close"
                                ToolTip="关闭">
                            <Path Data="M 3,3 L 13,13 M 13,3 L 3,13"
                                  StrokeThickness="2"
                                  Stroke="White"
                                  Stretch="Uniform" />
                        </Button>
                    </DockPanel>
                </Border>

                <!-- 列表区 -->
                <ScrollViewer Grid.Row="1"
                              Margin="0"
                              Padding="16"
                              VerticalScrollBarVisibility="Auto">
                    <ItemsControl ItemsSource="{Binding IpNodes}">
                        <!-- 卡片式面板 -->
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>

                        <!-- 行样式 -->
                        <ItemsControl.ItemContainerStyle>
                            <Style TargetType="ContentPresenter">
                                <Setter Property="Margin"
                                        Value="0,0,0,10" />
                            </Style>
                        </ItemsControl.ItemContainerStyle>

                        <!-- 行模板（两列栅格：键名 / 文本框） -->
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="{DynamicResource RegionBrush}"
                                        CornerRadius="10"
                                        Padding="12"
                                        BorderBrush="{DynamicResource BorderBrush}"
                                        BorderThickness="1">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="210" />
                                        </Grid.ColumnDefinitions>

                                        <!-- 左：键名 + 次级说明（可选） -->
                                        <StackPanel Grid.Column="0"
                                                    Orientation="Vertical"
                                                    VerticalAlignment="Center"
                                                    Margin="0,0,12,0">
                                            <TextBlock Text="{Binding Key}"
                                                       FontSize="15"
                                                       FontWeight="SemiBold"
                                                       Foreground="{DynamicResource PrimaryTextBrush}" />
                                        </StackPanel>

                                        <!-- 右：输入框（带占位与清空按钮） -->
                                        <Grid Grid.Column="1">
                                            <TextBox Text="{Binding Value, UpdateSourceTrigger=PropertyChanged}"
                                                     FontSize="15"
                                                     MinWidth="180"
                                                     Padding="10,6"
                                                     hc:InfoElement.Placeholder="请输入 IP 地址">
                                                <TextBox.Style>
                                                    <Style TargetType="TextBox"
                                                           BasedOn="{StaticResource TextBoxBaseStyle}">
                                                        <Setter Property="BorderBrush"
                                                                Value="{DynamicResource BorderBrush}" />
                                                        <Setter Property="BorderThickness"
                                                                Value="1" />
                                                        <Setter Property="Background"
                                                                Value="{DynamicResource TextBoxBackgroundBrush}" />
                                                        <Style.Triggers>
                                                            <Trigger Property="IsKeyboardFocused"
                                                                     Value="True">
                                                                <Setter Property="BorderBrush"
                                                                        Value="{DynamicResource PrimaryBrush}" />
                                                                <Setter Property="BorderThickness"
                                                                        Value="2" />
                                                                <Setter Property="Background"
                                                                        Value="{DynamicResource RegionBrush}" />
                                                            </Trigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </TextBox.Style>
                                            </TextBox>
                                        </Grid>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>

                <!-- 底部按钮区 -->
                <Border Grid.Row="2"
                        CornerRadius="0,0,16,16"
                        Background="{DynamicResource RegionBrush}"
                        Padding="16,12">
                    <DockPanel>
                        <StackPanel Orientation="Horizontal"
                                    HorizontalAlignment="Center"
                                    DockPanel.Dock="Left">
                            <Button Content="确认"
                                    Width="112"
                                    Height="36"
                                    FontSize="14"
                                    Margin="0,0,10,0"
                                    IsDefault="True"
                                    Style="{StaticResource ButtonPrimary}"
                                    Command="{Binding DataContext.ConfirmCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                    CommandParameter="{Binding DataContext.IpNodes, RelativeSource={RelativeSource AncestorType=UserControl}}" />
                            <Button Content="取消"
                                    Width="88"
                                    Height="36"
                                    FontSize="14"
                                    Command="hc:ControlCommands.Close" />
                        </StackPanel>
                    </DockPanel>
                </Border>
            </Grid>
        </Border>
    </Grid>
</UserControl>
